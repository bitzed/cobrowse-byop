<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cobrowse Agent (NPM)</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
    }
    body { display: flex; flex-direction: column; }
    
    /* Control Panel */
    .control-panel {
      padding: 12px 20px;
      background: #2d2d2d;
      border-bottom: 1px solid #444;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    .control-panel h1 {
      font-size: 16px;
      color: #fff;
      margin-right: 20px;
    }
    
    /* Method Badge */
    .method-badge {
      background: #28a745;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    
    /* PIN Input */
    .pin-input-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .pin-input-group label {
      color: #ccc;
      font-size: 14px;
    }
    .pin-input {
      padding: 8px 12px;
      border: 1px solid #555;
      border-radius: 4px;
      font-size: 16px;
      font-family: monospace;
      letter-spacing: 2px;
      text-transform: uppercase;
      width: 140px;
      background: #1e1e1e;
      color: #fff;
    }
    .pin-input:focus {
      outline: none;
      border-color: #0e71eb;
    }
    
    /* Buttons */
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .btn-primary { background: #0e71eb; color: white; }
    .btn-primary:hover { background: #0b5bc4; }
    
    /* Status */
    .status {
      font-size: 14px;
      color: #aaa;
      margin-left: auto;
    }
    
    /* Viewer Container */
    .viewer-container {
      flex: 1;
      position: relative;
      background: #1a1a1a;
      overflow: hidden;
    }
    
    /* Viewer Root - SDK renders iframe here */
    #viewer-root {
      width: 100%;
      height: 100%;
    }
    #viewer-root iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    
    /* Placeholder */
    .viewer-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #666;
    }
    .viewer-placeholder h2 {
      font-size: 24px;
      margin-bottom: 16px;
    }
    .viewer-placeholder p {
      font-size: 14px;
      max-width: 400px;
      text-align: center;
      line-height: 1.6;
    }
    .viewer-placeholder .highlight {
      color: #0e71eb;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Control Panel -->
  <div class="control-panel">
    <h1>ðŸ”µ Agent Viewer (NPM)</h1>
    <span class="method-badge">LOCAL RENDER</span>
    
    <div class="pin-input-group">
      <label for="pin-code">PIN:</label>
      <input type="text" id="pin-code" class="pin-input" placeholder="ABCD1234" maxlength="8">
    </div>
    
    <button class="btn btn-primary" onclick="handleJoinSession()">Join Session</button>
    
    <span class="status">Status: <span id="status">Loading...</span></span>
  </div>
  
  <!-- Viewer Container -->
  <div class="viewer-container">
    <div id="viewer-root">
      <div class="viewer-placeholder">
        <h2>Agent Viewer</h2>
        <p>Enter the <span class="highlight">PIN code</span> from the customer and click <span class="highlight">Join Session</span></p>
        <p style="margin-top: 16px; color: #888; font-size: 12px;">
          Using NPM mode with local rendering
        </p>
      </div>
    </div>
  </div>
  
  <!-- Cobrowse SDK -->
  <script src="/dist/agent.js"></script>
  
  <script>
    // Join with Enter key
    document.getElementById('pin-code').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        handleJoinSession();
      }
    });
    
    async function handleJoinSession() {
      const pinInput = document.getElementById('pin-code');
      const pinCode = pinInput.value.trim().toUpperCase();
      
      if (!pinCode) {
        alert('Please enter a PIN code');
        return;
      }
      
      if (pinCode.length !== 8) {
        alert('PIN code should be 8 characters');
        return;
      }
      
      try {
        if (window.CobrowseAgent) {
          await window.CobrowseAgent.joinSession(pinCode);
        } else {
          console.error('SDK not loaded');
        }
      } catch (error) {
        console.error('Failed to join session:', error);
      }
    }
  </script>
</body>
</html>